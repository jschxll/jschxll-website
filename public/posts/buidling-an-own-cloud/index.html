<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://jschall.net/images/favicon.png><title>Building an own cloud | Jan's site</title>
<meta name=title content="Building an own cloud"><meta name=description content="How I run Photoprism on my own homeserver to backup my photos without sharing my data with third parties"><meta name=keywords content="linux,homeserver,photoprism,docker,"><meta property="og:url" content="https://jschall.net/posts/buidling-an-own-cloud/"><meta property="og:site_name" content="Jan's site"><meta property="og:title" content="Building an own cloud"><meta property="og:description" content="How I run Photoprism on my own homeserver to backup my photos without sharing my data with third parties"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-28T00:00:00+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Homeserver"><meta property="article:tag" content="Photoprism"><meta property="article:tag" content="Docker"><meta property="og:image" content="https://jschall.net/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jschall.net/images/share.png"><meta name=twitter:title content="Building an own cloud"><meta name=twitter:description content="How I run Photoprism on my own homeserver to backup my photos without sharing my data with third parties"><meta itemprop=name content="Building an own cloud"><meta itemprop=description content="How I run Photoprism on my own homeserver to backup my photos without sharing my data with third parties"><meta itemprop=datePublished content="2024-04-28T00:00:00+00:00"><meta itemprop=dateModified content="2024-04-28T00:00:00+00:00"><meta itemprop=wordCount content="995"><meta itemprop=image content="https://jschall.net/images/share.png"><meta itemprop=keywords content="Linux,Homeserver,Photoprism,Docker"><meta name=referrer content="no-referrer-when-downgrade"><style>@font-face{font-family:SpaceGrotesk;src:url(../../fonts/SpaceGrotesk-Regular.ttf)}@font-face{font-family:FiraMono;src:url(../../fonts/FiraMono-Regular.ttf)}@font-face{font-family:Lora;src:url(../../fonts/Lora-Regular.ttf)}body{font-family:FiraMono;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#1d1d1d;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#e3dddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#b39ddb}.title{text-decoration:none;border:0}.title span{font-weight:400}nav{display:flex;justify-content:space-between;font-size:medium;font-family:SpaceGrotesk}nav:last-child{color:#817373}nav a{color:#d65d0e;margin-right:10px;text-decoration:underline 3px;font-weight:700;font-size:1.2em}textarea{width:100%;font-size:16px;background-color:#252525;color:#ddd}input{font-size:16px;background-color:#252525;color:#ddd}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#777}pre code{color:#ddd;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#ccc;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#aaa;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.post-data{display:flex;justify-content:space-between}@media only screen and (max-width:600px){.post-data{display:flex;flex-direction:column;align-items:start}nav{display:block}}</style><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token></head><body><header><nav><div><a href=/>home</a>
<a href=/posts>posts</a>
<a href=/photos>photos</a>
<a href=https://github.com/jschxll rel=me>git</a></div><div><span>/posts/buidling-an-own-cloud</span></div></nav></header><main><head><style>body{font-family:Lora}h1,.post-data{font-family:FiraMono}h2,h3,h4,h5,h6{font-style:italic}</style></head><h1>Building an own cloud</h1><div class=post-data><div><time datetime=2024-04-28 pubdate>28 Apr, 2024</time></div><div><a href=https://jschall.net/posts/linux/>#Linux</a>
<a href=https://jschall.net/posts/homeserver/>#Homeserver</a>
<a href=https://jschall.net/posts/photoprism/>#Photoprism</a>
<a href=https://jschall.net/posts/docker/>#Docker</a></div></div><p></p><content class=h-card><p>In recent weeks, I have been using my own cloud to back up my photos and videos from my smartphone and laptop by using a containerized Photoprism instance. Today, I want to share how I set up my server and Docker environment to get everything running.</p><h2 id=installing-the-servers-operating-system>Installing the Server&rsquo;s Operating System</h2><p>First, you should use a separate computer so your own cloud is always accessible when you need to access your photos. I had an old laptop lying around that I used, but you can also use a cloud server. To make management easier, Ubuntu Server is a good choice. That&rsquo;s why I used it to run my photo cloud. Download Ubuntu Server on <a href=https://ubuntu.com/download/server>this site</a> by clicking the download button.</p><p>Next, after the ISO file is downloaded, you need to flash the file onto a USB stick. To do this, download the BalenaEtcher tool. Once BalenaEtcher is successfully installed on your system, it&rsquo;s time to flash the ISO file onto the USB stick. Open BalenaEtcher, select &ldquo;Flash from File,&rdquo; and find your downloaded ISO. Then select your USB stick and press &ldquo;Flash!&rdquo;. This process can take some time, so be patient. After the flashing process, you will receive a message indicating that you can remove your USB stick.<br>Now it&rsquo;s time to install Ubuntu on your server. Insert the boot device (the USB stick) into your computer that will be used as a server and press ESC during boot. In the displayed menu, you should see the name of the USB stick, that you want to select by pressing ENTER. If the first boot doesn&rsquo;t work, please check in the BIOS if Secure Boot is disabled and try again.<br>Now follow the instructions in the Ubuntu Server installation menu. Make sure to enable the OpenSSH client during the installation so we can interact with our server later.</p><h2 id=post-installation>Post Installation</h2><p>After installing Ubuntu on your server, it&rsquo;s time to install the services we need to create a private cloud. But first, we need to access our server. We can use SSH for this. So open the terminal on your device (not the server) and enter:<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh YOUR_USER_NAME@SERVER_IP_ADRESS
</span></span></code></pre></div><p><br>Now you have full access to your server. At first, make sure your package manager is up to date. Run therefore</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update <span style=color:#f92672>&amp;&amp;</span> sudo apt-get upgrade -y
</span></span></code></pre></div><p>to update your mirror&rsquo;s repositories.</p><h2 id=installing-docker-and-photoprism>Installing Docker and Photoprism</h2><p>You can easily install Docker with those commands taken from the <a href=https://docs.docker.com/engine/install/ubuntu/>official docker installation guide</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Add Docker&#39;s official GPG key:</span>
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install ca-certificates curl
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0755</span> -d /etc/apt/keyrings
</span></span><span style=display:flex><span>sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
</span></span><span style=display:flex><span>sudo chmod a+r /etc/apt/keyrings/docker.asc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Add the repository to Apt sources:</span>
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#e6db74>&#34;deb [arch=</span><span style=color:#66d9ef>$(</span>dpkg --print-architecture<span style=color:#66d9ef>)</span><span style=color:#e6db74> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#66d9ef>$(</span>. /etc/os-release <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;</span>$VERSION_CODENAME<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74> stable&#34;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style=display:flex><span>sudo apt-get update
</span></span></code></pre></div><p>Now we added docker in our apt mirror list and should install docker packages via:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span></code></pre></div><p>For convenience, we will use the docker-compose-plugin to deploy the Photoprism instance with a simple YAML file. You can check if the installation was successful by displaying the Docker Compose version with <code>docker compose version</code>.<br>After installing Docker Compose, we can finally install the Photoprism image. I have already prepared a docker compose file which you can use if you like.<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/j-schall/photoprism-docker-compose.git
</span></span></code></pre></div><p>Feel free to costumize the file for your needs, but I would strongly recommend setting stronger passwords. Therefore, pay special attention when setting up your <em>PHOTOPRISM_USER_PASSWORD</em>. It needs to be the same as <em>MARIADB_USER_PASSWORD</em> and the username too.
Now direct to the folder where you saved the cloned docker-compose.yml file and execute it (<code>sudo docker compose up -d</code>). Check the container status with: <code>sudo docker ps </code>. If all went successfully you should find your running container there.</p><h2 id=setting-up-syncthing>Setting Up Syncthing</h2><p>If you have already opened the docker-compose file, you might have seen that Syncthing listens on port 8384. Open the Syncthing web interface, where you firstly have to set a strong password.<br>The next step varies. If you want to sync your photos and videos from your smartphone, download the Syncthing app from the Play Store. Unfortunately, there is no official Syncthing app for iOS yet. When you open the app, do the following:</p><ol><li>Go to the device menu and press the + button.</li><li>Next to the text field for the device ID, there should be a QR code icon. Press it.</li><li>Go back to the Syncthing web interface of your server.</li><li>Press the actions menu &lt; Device ID.</li><li>Scan the QR code with your Syncthing smartphone app and give it a name.</li><li>After a few seconds, a message should appear on the server&rsquo;s web interface where you confirm that it is your device.</li><li>Create a new folder in the smartphone app and link it to your photo directory.
Now the photos should be synced with your server.</li></ol><h2 id=introduction-to-photoprism>Introduction to Photoprism</h2><p>Once the photos from your smartphone are synced with the Syncthing instance on your server, we only need to import them into Photoprism. To do this, log into the Photoprism web interface, where you will find the &ldquo;Files&rdquo; section on the right sidebar. Click &ldquo;Import&rdquo; and select all your folders. After this process, you should see all your photos from your smartphone.</p><p>Congratulations üéâ You have just built your own cloud!</p><h2 id=tipps>Tipps</h2><h3 id=use-lan-instead-of-wlan>Use LAN Instead of WLAN</h3><p>I would strongly recommend using LAN instead of Wi-Fi. It is more stable and faster for uploading and downloading files. Additionally, it is less complex during the Ubuntu Server installation process as it is recognized directly by Ubuntu.</p><h3 id=keep-the-laptop-running-when-closing-the-lid>Keep the Laptop Running When Closing the Lid</h3><p>If you use a laptop as your server, it usually shuts down when you close the display. However, you can avoid this by following these configuration steps:</p><ol><li>Edit the file <code>/etc/systemd/logind.conf</code></li><li>Change <code>#HandleLidSwitch=suspend</code> to <code>HandleLidSwitch=ignore</code></li><li>Make sure the file contains the following: <code>LidSwitchIgnoreInhibited=no</code></li><li>Restart the operating system with: <code>sudo service systemd-logind restart</code></li></ol></content><section class=post-end><a class=next href=https://jschall.net/posts/ollama_web_ui/>&laquo Next</a></section><style>.prev{float:right}.next{float:left}.post-end{margin-top:40px;margin-bottom:40px}</style></main><footer><span>Made with</span> <a class=footer-link href=https://github.com/janraasch/hugo-bearblog/>Hugo  ï‚Ä¢·¥•‚Ä¢ î Bear</a>
|
<a class=footer-link href=/index.xml>RSS</a>
|
<a class=footer-link href=/legal-notice>legal notice</a>
|
<a class=footer-link href=/terms-of-privacy>terms of privacy</a><br><a class=footer-link href=https://xn--sr8hvo.ws/previous>‚Üê</a>
<span>An</span> <a class=footer-link href=https://xn--sr8hvo.ws>IndieWeb Webring</a> üï∏üíç
<a class=footer-link href=https://xn--sr8hvo.ws/next>‚Üí</a><style>.footer-link{font-size:small}span{font-size:small}</style></footer></body></html>