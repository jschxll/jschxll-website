<!doctype html><html lang=en-US><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=http://localhost:1313/images/favicon.png><title>Smarthome plasmaball | Jan's site</title>
<meta name=title content="Smarthome plasmaball"><meta name=description content="I recently decided to integrate my plasma ball into my smart home system. Why? Honestly, I just thought it would be a fun experiment, though it turned out to be a lot more challenging than expected, especially since I lack much experience with soldering and electrical engineering. Perfect conditions for such a project, right?"><meta name=keywords content="raspi5,docker,homeserver,linux,"><meta property="og:url" content="http://localhost:1313/posts/smarthome-plasmaball/"><meta property="og:site_name" content="Jan's site"><meta property="og:title" content="Smarthome plasmaball"><meta property="og:description" content="I recently decided to integrate my plasma ball into my smart home system. Why? Honestly, I just thought it would be a fun experiment, though it turned out to be a lot more challenging than expected, especially since I lack much experience with soldering and electrical engineering. Perfect conditions for such a project, right?"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-12T10:34:13+02:00"><meta property="article:modified_time" content="2024-08-12T10:34:13+02:00"><meta property="article:tag" content="Raspi5"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Homeserver"><meta property="article:tag" content="Linux"><meta property="og:image" content="http://localhost:1313/images/share.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/images/share.png"><meta name=twitter:title content="Smarthome plasmaball"><meta name=twitter:description content="I recently decided to integrate my plasma ball into my smart home system. Why? Honestly, I just thought it would be a fun experiment, though it turned out to be a lot more challenging than expected, especially since I lack much experience with soldering and electrical engineering. Perfect conditions for such a project, right?"><meta itemprop=name content="Smarthome plasmaball"><meta itemprop=description content="I recently decided to integrate my plasma ball into my smart home system. Why? Honestly, I just thought it would be a fun experiment, though it turned out to be a lot more challenging than expected, especially since I lack much experience with soldering and electrical engineering. Perfect conditions for such a project, right?"><meta itemprop=datePublished content="2024-08-12T10:34:13+02:00"><meta itemprop=dateModified content="2024-08-12T10:34:13+02:00"><meta itemprop=wordCount content="542"><meta itemprop=image content="http://localhost:1313/images/share.png"><meta itemprop=keywords content="Raspi5,Docker,Homeserver,Linux"><meta name=referrer content="no-referrer-when-downgrade"><style>@font-face{font-family:SpaceGrotesk;src:url(../../fonts/SpaceGrotesk-Regular.ttf)}@font-face{font-family:FiraMono;src:url(../../fonts/FiraMono-Regular.ttf)}@font-face{font-family:Lora;src:url(../../fonts/Lora-Regular.ttf)}body{font-family:FiraMono;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#1d1d1d;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#e3dddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#b39ddb}.title{text-decoration:none;border:0}.title span{font-weight:400}nav{display:flex;justify-content:space-between;font-size:medium;font-family:SpaceGrotesk}nav:last-child{color:#817373}nav a{color:#d65d0e;margin-right:10px;text-decoration:underline 3px;font-weight:700;font-size:1.2em}textarea{width:100%;font-size:16px;background-color:#252525;color:#ddd}input{font-size:16px;background-color:#252525;color:#ddd}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#777}pre code{color:#ddd;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#ccc;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#aaa;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}.post-data{display:flex;justify-content:space-between}@media only screen and (max-width:600px){.post-data{display:flex;flex-direction:column;align-items:start}nav{display:block}}</style><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token></head><body><header><nav><div><a href=/>home</a>
<a href=/posts>posts</a>
<a href=/photos>photos</a>
<a href=https://github.com/jschxll rel=me>git</a></div><div><span>/posts/smarthome-plasmaball</span></div></nav></header><main><head><style>body{font-family:Lora}h1,.post-data{font-family:FiraMono}h2,h3,h4,h5,h6{font-style:italic}</style></head><h1>Smarthome plasmaball</h1><div class=post-data><div><time datetime=2024-08-12 pubdate>12 Aug, 2024</time></div><div><a href=http://localhost:1313/posts/raspi5/>#Raspi5</a>
<a href=http://localhost:1313/posts/docker/>#Docker</a>
<a href=http://localhost:1313/posts/homeserver/>#Homeserver</a>
<a href=http://localhost:1313/posts/linux/>#Linux</a></div></div><p></p><content class=h-card><p>So, yeah, I guess I don&rsquo;t need to add much more than the title already reveals: I built a smarthome integration for my plasma ball. Why? I don&rsquo;t know, I thought it would be a fun idea, but in the end it got much worse than I thought, because I don&rsquo;t have really a good practice in soldering and electrical engineering. Good conditions, to start such a project, I think.</p><h3 id=the-hardware--idea>The Hardware & idea</h3><p>But how could I do it? After a bit of research and thinking, I got the idea of letting the plasma ball communicating over the MQTT protocol with a broker (my raspberry pie 5), which has on top a docker container running a Node Red web-dashboard, that make it possible to control the plasma ball via an on/off switch.</p><p>Here&rsquo;s a diagram to visualize the process:</p><p><img src=/images/smart_home_plasma_ball_diagram.drawio.png alt="Smart Home plasma ball diagram">
(Made with draw.io)</p><p>When the on/off message is sent to the broker, it will publish the message to the channel, where the client (the ESP) is subscribed to. Then, the microcontroller sends a digital signal to the Gate pin of a MOSFET, to establish a connection between the Drain and Source pin, which is in turn connected to a 5V battery.</p><p>The reason, I built it with a MOSFET, rather than connecting the battery directly to the ESP is because of the maximal voltage the power pin of the ESP can endure (max: 3.3V), before shutting the microcontroller down. On the other hand, the tranformer in the plasma ball needs 5V to power on, so I had to find a way to regulate the power between the two consumers.</p><p>Although, the ESP8266 can run with 5V, it is only possible with the micro USB port, which assumes that I have a battery with a USB port, which I don&rsquo;t have. I could easily use a powerbank, but it would be too big, to fit in the original case of the plasma ball. So I stuck with the MOSFET.</p><h3 id=software-configuration>Software configuration</h3><p>After a way too long time soldering all components together and five times questioning my life decisions. I finally made it work!!</p><p>Now, it&rsquo;s time to deal with the software. At first, I wrote a docker compose file with two services: Mosquitto and Node Red, which are communicating with each other in the docker host network. That makes the communication between the Node Red instance and the Mosquitto instance a lot easier. In Node Red, I installed the nodered-dashboard palette, to get dashboard components, like switches or diagrams. I made quickly via drag and drop a diagram with a switch and a MQTT-out-component, that publishes messages (true/false) to the subscribed channel of the ESP.</p><p>In the Mosquitto instance, I edited the configuration file to allow connections outside the localhost so that the ESP can connect to it.</p><p>In the end, it looks like this:</p><p>docker-compose.yml:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>mosquitto</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>eclipse-mosquitto</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>mosquitto</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1883</span>:<span style=color:#ae81ff>1883</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>9001</span>:<span style=color:#ae81ff>9001</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>extra_hosts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;host.docker.internal:host-gateway&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./mosquitto/config/mosquitto.conf:/mosquitto/config/mosquitto.config</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>node-red</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nodered/node-red</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>node-red</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#e6db74>&#34;0:0&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1880</span>:<span style=color:#ae81ff>1880</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>extra_hosts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;host.docker.internal:host-gateway&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./node_red_data:/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>log</span>:
</span></span></code></pre></div><p>mosquitto.conf:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>allow_anonymous true
</span></span><span style=display:flex><span>listener <span style=color:#ae81ff>1883</span>
</span></span><span style=display:flex><span>persistence true
</span></span><span style=display:flex><span>persistence_location /mosquitto/data
</span></span><span style=display:flex><span>log_dest file /mosquitto/log/mosquitto.log
</span></span></code></pre></div><p>The only thing left over, was to deploy the Node Red dashboard in my network.</p></content><section class=post-end><a class=prev href=http://localhost:1313/posts/arch-linux-experience/>Prev &raquo</a></section><style>.prev{float:right}.next{float:left}.post-end{margin-top:40px;margin-bottom:40px}</style></main><footer><span>Made with</span> <a class=footer-link href=https://github.com/janraasch/hugo-bearblog/>Hugo  ï‚Ä¢·¥•‚Ä¢ î Bear</a>
|
<a class=footer-link href=/index.xml>RSS</a>
|
<a class=footer-link href=/legal-notice>legal notice</a>
|
<a class=footer-link href=/terms-of-privacy>terms of privacy</a><br><a class=footer-link href=https://xn--sr8hvo.ws/previous>‚Üê</a>
<span>An</span> <a class=footer-link href=https://xn--sr8hvo.ws>IndieWeb Webring</a> üï∏üíç
<a class=footer-link href=https://xn--sr8hvo.ws/next>‚Üí</a><style>.footer-link{font-size:small}span{font-size:small}</style></footer></body></html>